# **å°‡ Promptflow æ–°å¢åˆ° Visual Studio Code å¤–æ›**

åœ¨ Copilot Stack ä¸­è§£æ±ºå•é¡Œçš„é—œéµæ˜¯æç¤ºã€‚ æˆ‘å€‘åœ¨å‰ç«¯æœ‰ Promptï¼Œå®ƒå¯ä»¥æ˜¯è«¸å¦‚â€œå¹«æˆ‘æå–é€™æ®µç¨‹å¼ç¢¼ï¼Œåˆ†æå®ƒï¼Œä¸¦å°‡å…¶è½‰æ›ç‚º Pythonâ€ä¹‹é¡åˆ¥çš„æŒ‡ä»¤çµ„åˆã€‚ æˆ‘å€‘å¯ä»¥åˆ©ç”¨Semantic Kernelçš„Plannerå°‡å…¶åˆ†ç‚ºä¸‰å€‹æ­¥é©Ÿï¼šç¨‹å¼ç¢¼æå–ã€åˆ†æã€è½‰æ›ç‚ºPythonã€‚ é€™ä¸‰å€‹æ­¥é©Ÿä¸­çš„æ¯ä¸€å€‹éƒ½åŒ…å«ä¸€å€‹ç°¡å–®çš„æµç¨‹ã€‚ æˆ‘å€‘æœ‰å¤§é‡çš„Flowsä¾†è§£æ±ºå¾Œç«¯æ‡‰ç”¨ä¸­çš„æ¥­å‹™å•é¡Œã€‚ é€šå¸¸é€™äº›æµç¨‹ç”±å›ºå®šæç¤ºçµ„æˆã€‚ å¦‚æœæˆ‘å€‘å˜—è©¦ç”¨å¾®æœå‹™ä¾†æ‹†è§£å®ƒï¼Œå°±æœƒç™¼ç¾æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹è™•ã€‚

é™¤äº†Semantic Kernelæ¡†æ¶ä¹‹å¤–ï¼Œå¾®è»Ÿé‚„ç™¼å¸ƒäº†Promptflowã€‚ åŠæ™‚è§£æ±ºæ˜¯è§£æ±ºå•é¡Œçš„é—œéµã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ Promptflow ä¾†æ¨™æº–åŒ–ç›¸é—œå…§å®¹ã€‚

## **PromptFlow**

Prompt flow æ˜¯ä¸€å¥—é–‹ç™¼å·¥å…·ï¼Œæ—¨åœ¨ç°¡åŒ–åŸºæ–¼ LLM çš„äººå·¥æ™ºæ…§æ‡‰ç”¨ç¨‹å¼çš„ç«¯åˆ°ç«¯é–‹ç™¼é€±æœŸï¼Œå¾æ§‹æ€ã€åŸå‹è¨­è¨ˆã€æ¸¬è©¦ã€è©•ä¼°åˆ°ç”Ÿç”¢éƒ¨ç½²å’Œç›£æ§ã€‚ å®ƒä½¿å³æ™‚å·¥ç¨‹è®Šå¾—æ›´åŠ å®¹æ˜“ï¼Œä¸¦ä½¿æ‚¨èƒ½å¤ å»ºæ§‹å…·æœ‰ç”Ÿç”¢å“è³ªçš„ LLM æ‡‰ç”¨ç¨‹å¼ã€‚

ä»¥ä¸Šæ–‡å­—ä¾†è‡ªPromptFlowæ–‡ä»¶ï¼ˆhttps://microsoft.github.io/promptflow/ï¼‰ã€‚ ä»¥æˆ‘çš„ç†è§£ï¼ŒPromptflowæ›´é©åˆåŸºæ–¼å¾Œç«¯çš„æ¥­å‹™é‚è¼¯ã€‚

æˆ‘å€‘è»Šé–“çš„ä¼æ¥­å‰¯é§•é§›å·²ç¶“æˆå‹ï¼Œä½†å°æ–¼ä¼æ¥­ä¾†èªªé‚„é é ä¸å¤ ã€‚ ç•¢ç«Ÿä¼æ¥­å¯ä»¥æºé€šæ–‡ä»¶ã€ç”¢ç”Ÿæ–‡ä»¶ã€æ“æœ‰è‡ªå·±çš„ç·¨ç¢¼é¢¨æ ¼ï¼Œé€™äº›éƒ½å¯ä»¥é€éå®¢è£½ä¾†å®Œæˆã€‚ åœ¨ä¸Šä¸€å€‹ç·´ç¿’ä¸­ï¼Œæˆ‘å€‘åœ¨æœ¬åœ°æ”¾ç½®äº†ä¸€äº›Promptè™•ç†ï¼Œä½†æ˜¯é€éPromptflowæˆ‘å€‘å¯ä»¥ä½¿ç”¨é›²åŸç”Ÿæ–¹æ³•ä¾†å®Œæˆæ›´å¤šæ“ä½œã€‚

## **ä»¥é›²åŸç”Ÿæ–¹å¼å»ºæ§‹æ–‡ä»¶èŠå¤©**

Promptflow ç¾åœ¨ä¸åƒ…é™æ–¼ Azureï¼Œé‚„å¯ä»¥åœ¨æœ¬åœ°å’Œå®¹å™¨ä¸­ä½¿ç”¨ï¼Œé€™æ„å‘³è‘—å®ƒæ›´åŠ éˆæ´»ã€‚ æˆ‘å€‘å¯ä»¥æ›´åŠ å°ˆæ³¨æ–¼ç™¼å±•ã€‚

å®‰è£ Promptflow éå¸¸ç°¡å–®ã€‚ æ‚¨å¯ä»¥å®‰è£ Promptflow for Visual Studio Code çš„æ“´å……ä¸¦é¸æ“‡â€œå®‰è£ä¾è³´é …â€ã€‚ å¯ä»¥çœ‹åˆ°éå¸¸æ¸…æ™°çš„å®‰è£èªªæ˜ã€‚ æˆ‘é€™è£¡å°±ä¸ä¸€ä¸€æè¿°äº†ã€‚

é€™è£¡æœ‰ä¸€å€‹æº–å‚™å·¥ä½œã€‚ æ‚¨å¯ä»¥åƒè€ƒæˆ‘çš„Microsoft Fabricéƒ¨è½æ ¼é¦–å…ˆä½¿ç”¨SKå°‡çŸ¥è­˜åŒ¯å…¥å’Œæå–åˆ°Microsoft Cognitive Searchä¸­ã€‚ ï¼ˆhttps://blog.fabric.microsoft.com/en-us/blog/use-semantic-kernel-with-lakehouse-in-microsoft-fabricï¼‰

è®“æˆ‘å€‘å»ºç«‹ä¸€å€‹ Chatflow ã€‚

1. å»ºç«‹ ChatFlow


![image](/imgs/03/01.png)

2. å»ºç«‹é€£çµ

Promptflow æ”¯æ´ä¸åŒçš„é€£çµã€‚ æ­¤è™•éœ€è¦é…ç½® Azure OpenAI é€£ç·šå’Œ Azure èªçŸ¥æœå°‹é€£ç·šã€‚ é€™è£¡åªéœ€è¦æ–°å¢é€£çµå³å¯ã€‚ é‡‘é‘°åœ¨å‘½ä»¤åˆ—ä¸­è¼¸å…¥ã€‚


![image](/imgs/03/02.png)

3. ç­è§£ Promptflow å°ˆæ¡ˆçš„çµæ§‹



![image](/imgs/03/03.png)


Promptflowçš„ä¸»è¦æª”æ¡ˆï¼š

a. .py - ç”¨æ–¼èˆ‡é‚è¼¯å’Œ LLM äº’å‹•çš„ Python æª”æ¡ˆ

b. .jinja2 - é€™æ˜¯æç¤ºçš„è¨­å®šã€‚ è£¡é¢å¯ä»¥å¯«Promptï¼Œæ¨¡å‹æ•™è‚²æ™‚æœƒç¹«çµã€‚

c. flow.dag.yaml - é€™å€‹æª”æ¡ˆéå¸¸æœ‰è¶£ã€‚ æ‚¨å¯ä»¥è¨­å®šåŸ·è¡Œæµç¨‹çš„é †åºï¼Œä¸¦ä¸”å¯ä»¥é¸æ“‡ä»¥è¦–è¦ºåŒ–å½¢å¼æª¢è¦–æª”æ¡ˆã€‚

å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥æª¢è¦–https://microsoft.github.io/promptflow/how-to-guides/develop-a-flow/develop-standard-flow.html



4. å»ºè­°æ‚¨ç›´æ¥é–‹å•Ÿç¯„ä¾‹å°ˆæ¡ˆ [åœ¨æ­¤ä¸‹è¼‰](./code/03/vscode-chatflow)
  ä¸¦ç›´æ¥åŸ·è¡Œå³å¯æª¢è¦–ã€‚ ç•¶ç„¶ï¼Œæ‚¨å¿…é ˆç¢ºä¿æ‚¨çš„é€£ç·šé…ç½®æ­£ç¢ºã€‚ ï¼ˆä¸è¦å¿˜è¨˜é¦–å…ˆåŸ·è¡Œ pip install -r request.txtï¼‰

5. åœ¨flow.dag.yamlä¸­å¯ä»¥é¸æ“‡runã€debugã€deployï¼Œå®Œæˆpromptflowé™¤éŒ¯ã€‚

![image](/imgs/03/04.png)

6. æœ¬åœ°åŸ·è¡Œå°±å¯ä»¥çœ‹åˆ°èŠå¤©ä»‹é¢


![image](/imgs/03/05.png)

7. é€é http://localhost:8080/swagger.json ç­è§£å‘¼å«ä»‹é¢

![image](/imgs/03/06.png)

8. æ–°å¢åˆ° Visual Studio Code å¤–æ›

å®‰è£ note-fetch

```bash

npm install node-fetch@2    


```

æ›´æ–° copilotenterprise.js 

```js

const fetch = require('node-fetch');

.........

async function RunPlanner(qa){

    const myUrl = 'http://127.0.0.1:8080/score';
    const myData = {"question":qa};
  
    const response = await fetch(myUrl, {
      method: 'POST',
      body: JSON.stringify(myData),
    }).then((response) => response.json());
  
    //console.log(response);

    return response.answer;


}


```

æ›´æ”¹ copilotenterprise.js 


```js

const {RunInSemanticKernel,RunPlanner} = require('./enterprisecopilot.js');

.........


	let webViewProvider={
			resolveWebviewView: (_webviewView , _webviewContex) => {
				_webviewView.webview.options={enableScripts:true};
				this.webView = _webviewView;
				this.webView.webview.html = initChatViewContent(this.webView,extensionURL);
				this.webView.webview.onDidReceiveMessage( async message => {
					switch (message.type) {
						case 'addQA':
							
							const result =  await RunPlanner(message.value); //await RunInSemanticKernel(message.value,"Translate");
							const strQA = 'ğŸ§‘:  <br/>' + message.value + '<br/>' + 'ğŸ¤–: <br/>'  + result + '<br/>';
							this.webView.webview.postMessage({ type: 'addQA', value:  strQA });
							break;
					}
				}, undefined, context.subscriptions);
			}
	};


```

åŸ·è¡Œ


![image](/imgs/03/07.png)

å¤ªæ£’äº†ï¼Œæ‚¨å·²ç¶“å¯ä»¥åšæ›´å¤šçš„å®¢è£½å·¥ä½œäº†ã€‚ ç•¶ç„¶ï¼Œé€™å€‹å·¥ä½œåŠåªæ˜¯ä½ çš„ç¬¬ä¸€æ­¥ï¼Œæˆ–è€…æˆ‘å€‘ä¸åƒ…åƒ…æ˜¯ä½¿ç”¨Semantic Kernelï¼Œèˆ‡Promptflowçµåˆé‚„æœ‰æ›´å¤šçš„å¯èƒ½æ€§ã€‚


